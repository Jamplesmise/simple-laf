# Sprint 12: Artifacts å¢å¼º - ä»»åŠ¡æ¸…å•

## ä»»åŠ¡æ¦‚è§ˆ

| ä»»åŠ¡ | å­æ¨¡å— | è½¨é“ | ä¼˜å…ˆçº§ | é¢„ä¼° | ä¾èµ– |
|------|--------|------|-------|------|------|
| 12.1.1 HTML é¢„è§ˆç»„ä»¶ | é¢„è§ˆ | å‰ç«¯ | P0 | 3h | æ—  |
| 12.1.2 React é¢„è§ˆç»„ä»¶ | é¢„è§ˆ | å‰ç«¯ | P1 | 3h | æ—  |
| 12.1.3 Mermaid/SVG é¢„è§ˆ | é¢„è§ˆ | å‰ç«¯ | P2 | 2h | æ—  |
| 12.2.1 å¯¼å‡º API | å¯¼å‡º | åç«¯ | P0 | 2h | æ—  |
| 12.2.2 å¯¼å‡ºå¯¹è¯æ¡† | å¯¼å‡º | å‰ç«¯ | P0 | 2h | 12.2.1 |
| 12.3.1 æ–‡ä»¶ä¸Šä¼  API | ä¸Šä¼  | åç«¯ | P1 | 2h | æ—  |
| 12.3.2 æ–‡ä»¶ä¸Šä¼ ç»„ä»¶ | ä¸Šä¼  | å‰ç«¯ | P1 | 3h | 12.3.1 |

---

## 12.1 HTML/React é¢„è§ˆ

### 12.1.1 HTML é¢„è§ˆç»„ä»¶

**æ–‡ä»¶**ï¼š`src/client/components/AI/Artifacts/HTMLPreview.tsx`

**å…·ä½“æ­¥éª¤**ï¼š

- [ ] åˆ›å»º iframe sandbox å®¹å™¨
- [ ] è®¾ç½®å®‰å…¨ç­–ç•¥ï¼ˆallow-scriptsï¼‰
- [ ] æ”¯æŒ CSS æ ·å¼æ¸²æŸ“
- [ ] æ·»åŠ å…¨å±é¢„è§ˆæŒ‰é’®

```typescript
const HTMLPreview = ({ html }: { html: string }) => {
  return (
    <div className="html-preview">
      <div className="preview-header">
        <span>HTML é¢„è§ˆ</span>
        <button onClick={toggleFullscreen}>å…¨å±</button>
      </div>
      <iframe
        sandbox="allow-scripts"
        srcDoc={html}
        style={{ width: '100%', height: '400px', border: 'none' }}
      />
    </div>
  )
}
```

**éªŒæ”¶**ï¼š
- [ ] HTML æ­£ç¡®æ¸²æŸ“
- [ ] CSS æ ·å¼ç”Ÿæ•ˆ
- [ ] JS è„šæœ¬å¯æ‰§è¡Œï¼ˆæ²™ç®±å†…ï¼‰
- [ ] æ— æ³•è®¿é—®çˆ¶é¡µé¢

---

### 12.1.2 React é¢„è§ˆç»„ä»¶

**æ–‡ä»¶**ï¼š`src/client/components/AI/Artifacts/ReactPreview.tsx`

**å…·ä½“æ­¥éª¤**ï¼š

- [ ] å®‰è£… `@babel/standalone` ä¾èµ–
- [ ] å®ç° JSX ç¼–è¯‘
- [ ] åˆ›å»ºæ²™ç®± React ç¯å¢ƒ
- [ ] é”™è¯¯è¾¹ç•Œå¤„ç†

```typescript
const ReactPreview = ({ code }: { code: string }) => {
  const [Component, setComponent] = useState<React.FC | null>(null)
  const [error, setError] = useState<string | null>(null)

  useEffect(() => {
    try {
      // ä½¿ç”¨ Babel ç¼–è¯‘ JSX
      const compiled = Babel.transform(code, { presets: ['react'] }).code
      // åœ¨æ²™ç®±ä¸­æ‰§è¡Œ
      const fn = new Function('React', `return ${compiled}`)
      setComponent(() => fn(React))
      setError(null)
    } catch (e) {
      setError(e.message)
    }
  }, [code])

  if (error) return <div className="error">{error}</div>
  if (!Component) return <div>Loading...</div>
  return <Component />
}
```

**éªŒæ”¶**ï¼š
- [ ] JSX æ­£ç¡®ç¼–è¯‘
- [ ] ç»„ä»¶æ­£ç¡®æ¸²æŸ“
- [ ] é”™è¯¯å‹å¥½æç¤º
- [ ] ä¸å½±å“ä¸»é¡µé¢

---

### 12.1.3 Mermaid/SVG é¢„è§ˆ

**æ–‡ä»¶**ï¼š`src/client/components/AI/Artifacts/MermaidPreview.tsx`

**å…·ä½“æ­¥éª¤**ï¼š

- [ ] å®‰è£… `mermaid` ä¾èµ–
- [ ] å®ç° Mermaid å›¾è¡¨æ¸²æŸ“
- [ ] å®ç° SVG ç›´æ¥å±•ç¤º
- [ ] æ”¯æŒå¯¼å‡ºä¸ºå›¾ç‰‡

**éªŒæ”¶**ï¼š
- [ ] æµç¨‹å›¾æ­£ç¡®æ¸²æŸ“
- [ ] æ—¶åºå›¾æ­£ç¡®æ¸²æŸ“
- [ ] SVG æ­£ç¡®å±•ç¤º
- [ ] å¯å¯¼å‡ºå›¾ç‰‡

---

## 12.2 å¯¼å‡ºåŠŸèƒ½

### 12.2.1 å¯¼å‡º API

**æ–‡ä»¶**ï¼š`src/server/routes/ai.ts`

**API**ï¼š`GET /api/ai/conversations/:id/export`

```typescript
// æŸ¥è¯¢å‚æ•°
format: 'markdown' | 'json'

// Markdown å“åº”
Content-Type: text/markdown
Content-Disposition: attachment; filename="å¯¹è¯æ ‡é¢˜.md"

# å¯¹è¯: å‡½æ•°ä¼˜åŒ–è®¨è®º
æ—¥æœŸ: 2025-01-20
æ¨¡å‹: Claude Sonnet 4

## ç”¨æˆ·
å¸®æˆ‘ä¼˜åŒ–è¿™ä¸ªå‡½æ•°

## AI
æˆ‘æ¥å¸®ä½ ä¼˜åŒ–...

\`\`\`typescript
// ä¼˜åŒ–åçš„ä»£ç 
\`\`\`

// JSON å“åº”
{
  success: true,
  data: {
    title: string,
    messages: Message[],
    createdAt: Date,
    model: string
  }
}
```

**éªŒæ”¶**ï¼š
- [ ] Markdown æ ¼å¼æ­£ç¡®
- [ ] JSON æ ¼å¼å®Œæ•´
- [ ] ä»£ç å—ä¿ç•™
- [ ] æ–‡ä»¶åæ­£ç¡®

---

### 12.2.2 å¯¼å‡ºå¯¹è¯æ¡†

**æ–‡ä»¶**ï¼š`src/client/components/AI/Export/ExportDialog.tsx`

**å…·ä½“æ­¥éª¤**ï¼š

- [ ] åˆ›å»ºå¯¼å‡ºå¯¹è¯æ¡†
- [ ] æ ¼å¼é€‰æ‹©ï¼ˆMarkdown/JSONï¼‰
- [ ] é¢„è§ˆå¯¼å‡ºå†…å®¹
- [ ] è§¦å‘ä¸‹è½½

**UI è®¾è®¡**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¯¼å‡ºå¯¹è¯                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  é€‰æ‹©æ ¼å¼:                                          â”‚
â”‚  â—‹ Markdown (.md)  - é€‚åˆé˜…è¯»å’Œåˆ†äº«                 â”‚
â”‚  â—‹ JSON (.json)    - é€‚åˆæ•°æ®å¤„ç†                   â”‚
â”‚                                                     â”‚
â”‚  åŒ…å«å†…å®¹:                                          â”‚
â”‚  â˜‘ å¯¹è¯æ¶ˆæ¯                                         â”‚
â”‚  â˜‘ ä»£ç å—                                           â”‚
â”‚  â–¡ å·¥å…·è°ƒç”¨è¯¦æƒ…                                     â”‚
â”‚                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          [å–æ¶ˆ]  [å¯¼å‡º]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**éªŒæ”¶**ï¼š
- [ ] æ ¼å¼é€‰æ‹©æ­£å¸¸
- [ ] ä¸‹è½½æ–‡ä»¶æ­£ç¡®
- [ ] å†…å®¹å®Œæ•´

---

## 12.3 æ–‡ä»¶ä¸Šä¼ 

### 12.3.1 æ–‡ä»¶ä¸Šä¼  API

**æ–‡ä»¶**ï¼š`src/server/routes/ai.ts`

**API**ï¼š`POST /api/ai/conversations/:id/files`

```typescript
// è¯·æ±‚ (multipart/form-data)
file: File

// å“åº”
{
  success: true,
  data: {
    id: string,
    name: string,
    type: string,
    size: number,
    content: string,  // æ–‡æœ¬å†…å®¹
    tokens: number    // ä¼°ç®— tokens
  }
}

// æ”¯æŒçš„æ–‡ä»¶ç±»å‹
const ALLOWED_TYPES = [
  'text/plain',
  'text/markdown',
  'application/json',
  'text/javascript',
  'text/typescript',
]
```

**éªŒæ”¶**ï¼š
- [ ] æ–‡ä»¶ä¸Šä¼ æˆåŠŸ
- [ ] å†…å®¹æ­£ç¡®è§£æ
- [ ] ä¸æ”¯æŒç±»å‹è¿”å›é”™è¯¯
- [ ] æ–‡ä»¶å¤§å°é™åˆ¶ï¼ˆ1MBï¼‰

---

### 12.3.2 æ–‡ä»¶ä¸Šä¼ ç»„ä»¶

**æ–‡ä»¶**ï¼š`src/client/components/AI/FileUpload/index.tsx`

**å…·ä½“æ­¥éª¤**ï¼š

- [ ] åˆ›å»º DropZone æ‹–æ‹½åŒºåŸŸ
- [ ] æ”¯æŒç‚¹å‡»é€‰æ‹©æ–‡ä»¶
- [ ] æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
- [ ] æ˜¾ç¤ºå·²ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨
- [ ] æ”¯æŒåˆ é™¤æ–‡ä»¶

**UI è®¾è®¡**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                             â”‚   â”‚
â”‚  â”‚      ğŸ“„ æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œï¼Œæˆ–ç‚¹å‡»ä¸Šä¼            â”‚   â”‚
â”‚  â”‚                                             â”‚   â”‚
â”‚  â”‚      æ”¯æŒ: .txt .md .json .js .ts           â”‚   â”‚
â”‚  â”‚                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                     â”‚
â”‚  å·²ä¸Šä¼ æ–‡ä»¶:                                        â”‚
â”‚  â”œâ”€ config.json (2.3KB, 450 tokens)        [âœ•]    â”‚
â”‚  â””â”€ utils.ts (5.1KB, 1,200 tokens)         [âœ•]    â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**éªŒæ”¶**ï¼š
- [ ] æ‹–æ‹½ä¸Šä¼ æ­£å¸¸
- [ ] ç‚¹å‡»ä¸Šä¼ æ­£å¸¸
- [ ] è¿›åº¦æ˜¾ç¤ºæ­£ç¡®
- [ ] åˆ é™¤åŠŸèƒ½æ­£å¸¸

---

## å¹¶è¡Œå¼€å‘è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Sprint 12 å¹¶è¡Œå¼€å‘å›¾                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  åç«¯å¼€å‘è€…:                                                â”‚
â”‚  â”œâ”€ 12.2.1 å¯¼å‡º API (2h)                                   â”‚
â”‚  â””â”€ 12.3.1 æ–‡ä»¶ä¸Šä¼  API (2h)                               â”‚
â”‚                                                            â”‚
â”‚  å‰ç«¯å¼€å‘è€… A:                                              â”‚
â”‚  â”œâ”€ 12.1.1 HTML é¢„è§ˆç»„ä»¶ (3h)                              â”‚
â”‚  â”œâ”€ 12.1.2 React é¢„è§ˆç»„ä»¶ (3h)                             â”‚
â”‚  â””â”€ 12.1.3 Mermaid/SVG é¢„è§ˆ (2h)                           â”‚
â”‚                                                            â”‚
â”‚  å‰ç«¯å¼€å‘è€… B:                                              â”‚
â”‚  â”œâ”€ 12.2.2 å¯¼å‡ºå¯¹è¯æ¡† (2h) â†’ ä¾èµ– 12.2.1                   â”‚
â”‚  â””â”€ 12.3.2 æ–‡ä»¶ä¸Šä¼ ç»„ä»¶ (3h) â†’ ä¾èµ– 12.3.1                 â”‚
â”‚                                                            â”‚
â”‚  æ—¶é—´çº¿:                                                    â”‚
â”‚  Day 1: åç«¯å®Œæˆ + é¢„è§ˆç»„ä»¶å®Œæˆ                             â”‚
â”‚  Day 2: å¯¼å‡º + ä¸Šä¼ ç»„ä»¶                                    â”‚
â”‚  Day 3: é›†æˆæµ‹è¯•                                           â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æµ‹è¯•æ¸…å•

- [ ] å•å…ƒæµ‹è¯•ï¼šHTML å®‰å…¨è¿‡æ»¤
- [ ] å•å…ƒæµ‹è¯•ï¼šReact ç¼–è¯‘é”™è¯¯å¤„ç†
- [ ] é›†æˆæµ‹è¯•ï¼šæ–‡ä»¶ä¸Šä¼ å®Œæ•´æµç¨‹
- [ ] E2E æµ‹è¯•ï¼šå¯¼å‡ºåŠŸèƒ½
- [ ] å®‰å…¨æµ‹è¯•ï¼šiframe æ²™ç®±éš”ç¦»
